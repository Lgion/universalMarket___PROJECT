<!DOCTYPE html>
<html>
<head>
    <title>Supermarché Virtual - Vue Simple</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer;
        let playerGroup;

        function init() {
            // Scène de base
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf0f0f0);
            
            // Caméra
            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 10, 2); // Position légèrement au-dessus et derrière l'avatar
            camera.lookAt(0, 0, -5); // Regarde devant

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Éclairage
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 10);
            scene.add(directionalLight);

            // Sol
            const floorGeometry = new THREE.PlaneGeometry(20, 50);
            const floorMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xcccccc,
                roughness: 0.8
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            scene.add(floor);

            // Groupe pour l'avatar et le caddie
            playerGroup = new THREE.Group();
            
            // Avatar (représenté par un sprite)
            const textureLoader = new THREE.TextureLoader();
            textureLoader.load('supermarket atlas.png', (texture) => {
                const spriteMaterial = new THREE.SpriteMaterial({ map: texture });
                const sprite = new THREE.Sprite(spriteMaterial);
                sprite.scale.set(2, 2, 1);
                playerGroup.add(sprite);
            });

            playerGroup.position.set(0, 0.1, 0); // Légèrement au-dessus du sol
            scene.add(playerGroup);

            // Rayons (têtes de gondole)
            const aisleGeometry = new THREE.BoxGeometry(3, 4, 2);
            const aisleMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x666666,
                roughness: 0.7
            });

            // Création des rayons de chaque côté
            for(let z = -20; z <= 20; z += 5) {
                // Rayon gauche
                const leftAisle = new THREE.Mesh(aisleGeometry, aisleMaterial);
                leftAisle.position.set(-8, 2, z);
                scene.add(leftAisle);

                // Rayon droit
                const rightAisle = new THREE.Mesh(aisleGeometry, aisleMaterial);
                rightAisle.position.set(8, 2, z);
                scene.add(rightAisle);
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        // Contrôles basiques
        document.addEventListener('keydown', (event) => {
            const speed = 0.5;
            switch(event.key) {
                case 'ArrowUp':
                case 'z':
                    playerGroup.position.z -= speed;
                    camera.position.z -= speed;
                    break;
                case 'ArrowDown':
                case 's':
                    playerGroup.position.z += speed;
                    camera.position.z += speed;
                    break;
                case 'ArrowLeft':
                case 'q':
                    if (playerGroup.position.x > -6) {
                        playerGroup.position.x -= speed;
                        camera.position.x -= speed;
                    }
                    break;
                case 'ArrowRight':
                case 'd':
                    if (playerGroup.position.x < 6) {
                        playerGroup.position.x += speed;
                        camera.position.x += speed;
                    }
                    break;
            }
            camera.lookAt(playerGroup.position.x, 0, playerGroup.position.z - 5);
        });

        // Gestion du redimensionnement
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        init();
        animate();
    </script>
</body>
</html>
